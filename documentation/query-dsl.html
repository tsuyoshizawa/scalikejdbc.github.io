<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <!-- Use title if it's in the page YAML frontmatter -->
    <title>QueryDSL - ScalikeJDBC</title>
    <script type="text/javascript" src="//codeorigin.jquery.com/jquery-1.10.2.min.js"></script>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.1/css/bootstrap.min.css"/>
    <link href="/stylesheets/all.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/all.js" type="text/javascript"></script>
  </head>
  <body>
    <div class="container">
      <div class="row">
    <div class="navbar navbar-default" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="/"><img src="/images/logo_small.png" /></a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="dropdown">
              <a href="/documentation" class="dropdown-toggle" data-toggle="dropdown">Documentation&nbsp;<b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="/documentation/setup.html">Setup</a></li>
                <li><a href="/documentation/configuration.html">Configuration</a></li>
                <li><a href="/documentation/connection-pool.html">Connection Pool</a></li>
                <li><a href="/documentation/operations.html">Operations</a></li>
                <li><a href="/documentation/transaction.html">Transaction</a></li>
                <li><a href="/documentation/auto-session.html">Auto Session</a></li>
                <li><a href="/documentation/sql-interpolation.html">SQLInterpolation</a></li>
                <li><a href="/documentation/query-dsl.html">QueryDSL</a></li>
                <li><a href="/documentation/one-to-x.html">One-to-x API</a></li>
                <li><a href="/documentation/query-inspector.html">Query Inspector</a></li>
                <li><a href="/documentation/reverse-engineering.html">Reverse Engineering</a></li>
                <li><a href="/documentation/testing.html">Testing</a></li>
                <li><a href="/documentation/playframework-support.html">Play2 Support</a></li>
                <li><a href="/contribution.html">Contribution</a></li>
                <li><a href="/documentation/dbconsole.html">dbconsole</a></li>
              </ul>
            </li>
            <li><a href="https://groups.google.com/group/scalikejdbc-users-group">Users Group</a></li>
            <li><a href="https://github.com/scalikejdbc/scalikejdbc">Source</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
        <div class="col-xs-2">
          <div class="content small">
            <h5>Documentation</h5>
            <hr/>
            <p><a href="/documentation/setup.html">Setup</a></p>
            <p><a href="/documentation/configuration.html">Configuration</a></p>
            <p><a href="/documentation/connection-pool.html">Connection Pool</a></p>
            <p><a href="/documentation/operations.html">Operations</a></p>
            <p><a href="/documentation/transaction.html">Transaction</a></p>
            <p><a href="/documentation/auto-session.html">Auto Session</a></p>
            <p><a href="/documentation/sql-interpolation.html">SQLInterpolation</a></p>
            <p><a href="/documentation/query-dsl.html">QueryDSL</a></p>
            <p><a href="/documentation/one-to-x.html">One-to-x API</a></p>
            <p><a href="/documentation/query-inspector.html">Query Inspector</a></p>
            <p><a href="/documentation/reverse-engineering.html">Reverse Engineering</a></p>
            <p><a href="/documentation/testing.html">Testing</a></p>
            <p><a href="/documentation/playframework-support.html">Play2 Support</a></p>
            <p><a href="/contribution.html">Contribution</a></p>
            <p><a href="/documentation/dbconsole.html">dbconsole</a></p>
          </div>
        </div>
        <div class="col-xs-10">
          <div class="content">
<a href="https://github.com/scalikejdbc/scalikejdbc"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>
            <h2 id="toc_0">QueryDSL</h2>

<hr/>

<h3 id="toc_1">Introduction</h3>

<p>Since version 1.6.0, Query DSL is newly added. It&rsquo;s much readable and type-safe DSL.</p>
<pre class="highlight java"><span class="n">val</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">123</span>
<span class="n">val</span> <span class="o">(</span><span class="n">m</span><span class="o">,</span> <span class="n">g</span><span class="o">)</span> <span class="o">=</span> <span class="o">(</span><span class="n">GroupMember</span><span class="o">.</span><span class="na">syntax</span><span class="o">(</span><span class="s">&quot;m&quot;</span><span class="o">),</span> <span class="n">Group</span><span class="o">.</span><span class="na">syntax</span><span class="o">(</span><span class="s">&quot;g&quot;</span><span class="o">))</span>
<span class="n">val</span> <span class="n">groupMember</span> <span class="o">=</span> <span class="n">sql</span><span class="s">&quot;&quot;&quot;
  select
    ${m.result.*}, ${g.result.*}
  from
    ${GroupMember.as(m)} left join ${Group.as(g)} on ${m.groupId} = ${g.id}
  where
    ${m.id} = ${id}
  &quot;&quot;&quot;</span>
    <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">GroupMember</span><span class="o">(</span><span class="n">m</span><span class="o">,</span> <span class="n">g</span><span class="o">)).</span><span class="na">single</span><span class="o">.</span><span class="na">apply</span><span class="o">()</span>
</pre>
<p>You can re-write this SQLInterpolation code by using QueryDSL as follow.</p>

<p>We believe this code is much simpler and quite understandable.</p>
<pre class="highlight java"><span class="n">val</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">123</span>
<span class="n">val</span> <span class="o">(</span><span class="n">m</span><span class="o">,</span> <span class="n">g</span><span class="o">)</span> <span class="o">=</span> <span class="o">(</span><span class="n">GroupMember</span><span class="o">.</span><span class="na">syntax</span><span class="o">(</span><span class="s">&quot;m&quot;</span><span class="o">),</span> <span class="n">Group</span><span class="o">.</span><span class="na">syntax</span><span class="o">(</span><span class="s">&quot;g&quot;</span><span class="o">))</span>
<span class="n">val</span> <span class="n">groupMember</span> <span class="o">=</span> <span class="n">withSQL</span> <span class="o">{</span>
  <span class="n">select</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">GroupMember</span> <span class="n">as</span> <span class="n">m</span><span class="o">).</span><span class="na">leftJoin</span><span class="o">(</span><span class="n">Group</span> <span class="n">as</span> <span class="n">g</span><span class="o">).</span><span class="na">on</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">groupId</span><span class="o">,</span> <span class="n">g</span><span class="o">.</span><span class="na">id</span><span class="o">)</span>
    <span class="o">.</span><span class="na">where</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">id</span><span class="o">,</span> <span class="n">id</span><span class="o">)</span>
<span class="o">}.</span><span class="na">map</span><span class="o">(</span><span class="n">GroupMember</span><span class="o">(</span><span class="n">m</span><span class="o">,</span> <span class="n">g</span><span class="o">)).</span><span class="na">single</span><span class="o">.</span><span class="na">apply</span><span class="o">()</span>
</pre>
<p>More examples are</p>
<pre class="highlight java"><span class="n">val</span> <span class="n">m</span> <span class="o">=</span> <span class="n">Member</span><span class="o">.</span><span class="na">syntax</span><span class="o">(</span><span class="s">&quot;m&quot;</span><span class="o">)</span>
<span class="n">val</span> <span class="nl">ids:</span> <span class="n">List</span><span class="o">[</span><span class="n">Long</span><span class="o">]</span> <span class="o">=</span> <span class="n">sql</span><span class="s">&quot;select ${m.result.id} from ${Member.as(m)} where ${m.gourpId} = 1&quot;</span>
<span class="n">val</span> <span class="n">members</span> <span class="o">=</span> <span class="n">sql</span><span class="s">&quot;select ${m.result.*} from ${Member.as(m)}&quot;</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">Member</span><span class="o">(</span><span class="n">m</span><span class="o">)).</span><span class="na">list</span><span class="o">.</span><span class="na">apply</span><span class="o">()</span>
</pre>
<p>will be like this:</p>
<pre class="highlight java"><span class="n">val</span> <span class="n">m</span> <span class="o">=</span> <span class="n">Member</span><span class="o">.</span><span class="na">syntax</span><span class="o">(</span><span class="s">&quot;m&quot;</span><span class="o">)</span>
<span class="n">val</span> <span class="nl">ids:</span> <span class="n">List</span><span class="o">[</span><span class="n">Long</span><span class="o">]</span> <span class="o">=</span> <span class="n">withSQL</span> <span class="o">{</span> <span class="n">select</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">result</span><span class="o">.</span><span class="na">id</span><span class="o">).</span><span class="na">from</span><span class="o">(</span><span class="n">Member</span> <span class="n">as</span> <span class="n">m</span><span class="o">).</span><span class="na">where</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">groupId</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span> <span class="o">}</span>
  <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">rs</span> <span class="o">=&gt;</span> <span class="n">rs</span><span class="o">.</span><span class="na">long</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">resultName</span><span class="o">.</span><span class="na">id</span><span class="o">)).</span><span class="na">list</span><span class="o">.</span><span class="na">apply</span><span class="o">()</span>
<span class="n">val</span> <span class="n">members</span> <span class="o">=</span> <span class="n">withSQL</span> <span class="o">{</span> <span class="n">select</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">Member</span> <span class="n">as</span> <span class="n">m</span><span class="o">)</span> <span class="o">}.</span><span class="na">map</span><span class="o">(</span><span class="n">Member</span><span class="o">(</span><span class="n">m</span><span class="o">)).</span><span class="na">list</span><span class="o">.</span><span class="na">apply</span><span class="o">()</span>
<span class="c1">// or select.all(m).from(Member as m)</span>
</pre>
<hr/>

<h3 id="toc_2">QueryDSL Reference</h3>

<p>FYI: You can find some example in QueryDSL&rsquo;s test code:</p>

<p><a href="https://github.com/scalikejdbc/scalikejdbc/blob/master/scalikejdbc-interpolation/src/test/scala/scalikejdbc/QueryInterfaceSpec.scala">scalikejdbc-interpolation/src/test/scala/scalikejdbc/QueryInterfaceSpec.scala</a></p>

<p><code>sqls</code> is alias for <code>SQLSyntax</code> object (enabled when you import <code>scalikejdbc.SQLInterpolation._</code>.). Methods that are defined on <code>object SQLSyntax</code> is available everywhere.</p>

<p><a href="https://github.com/scalikejdbc/scalikejdbc/blob/master/scalikejdbc-interpolation-core/src/main/scala/scalikejdbc/interpolation/SQLSyntax.scala">scalikejdbc-interpolation-core/src/main/scala/scalikejdbc/interpolation/SQLSyntax.scala</a></p>

<hr/>

<h4 id="toc_3">Join queries</h4>
<pre class="highlight java"><span class="n">val</span> <span class="nl">orders:</span> <span class="n">List</span><span class="o">[</span><span class="n">Order</span><span class="o">]</span> <span class="o">=</span> <span class="n">withSQL</span> <span class="o">{</span>
  <span class="n">select</span>
    <span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">Order</span> <span class="n">as</span> <span class="n">o</span><span class="o">)</span>
    <span class="o">.</span><span class="na">innerJoin</span><span class="o">(</span><span class="n">Product</span> <span class="n">as</span> <span class="n">p</span><span class="o">).</span><span class="na">on</span><span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">productId</span><span class="o">,</span> <span class="n">p</span><span class="o">.</span><span class="na">id</span><span class="o">)</span>
    <span class="o">.</span><span class="na">leftJoin</span><span class="o">(</span><span class="n">Account</span> <span class="n">as</span> <span class="n">a</span><span class="o">).</span><span class="na">on</span><span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">accountId</span><span class="o">,</span> <span class="n">a</span><span class="o">.</span><span class="na">id</span><span class="o">)</span>
    <span class="o">.</span><span class="na">where</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">productId</span><span class="o">,</span> <span class="mi">123</span><span class="o">)</span>
    <span class="o">.</span><span class="na">orderBy</span><span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">id</span><span class="o">).</span><span class="na">desc</span>
    <span class="o">.</span><span class="na">limit</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span>
    <span class="o">.</span><span class="na">offset</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>
  <span class="o">}.</span><span class="na">map</span><span class="o">(</span><span class="n">Order</span><span class="o">(</span><span class="n">o</span><span class="o">,</span> <span class="n">p</span><span class="o">,</span> <span class="n">a</span><span class="o">)).</span><span class="na">list</span><span class="o">.</span><span class="na">apply</span><span class="o">()</span>
</pre>
<p><code>.on(o.productId, p.id)</code> is simply converted to <code>sqls&quot;${o.productId} = ${p.id}&quot;</code>. If you need to write more complex condition to join tables, use <code>sqls</code> directly.</p>
<pre class="highlight java">  <span class="o">.</span><span class="na">innerJoin</span><span class="o">(</span><span class="n">Product</span> <span class="n">as</span> <span class="n">p</span><span class="o">).</span><span class="na">on</span><span class="o">(</span><span class="n">sqls</span><span class="s">&quot;${o.proudctId} = ${p.id} and ${o.deletedAt} is not null&quot;</span><span class="o">)</span>
</pre>
<hr/>

<h4 id="toc_4">Dynamic query building</h4>
<pre class="highlight java"><span class="n">def</span> <span class="nf">findOrder</span><span class="p">(</span><span class="nl">id:</span> <span class="n">Long</span><span class="o">,</span> <span class="nl">accountRequired:</span> <span class="n">Boolean</span><span class="o">)</span> <span class="o">=</span> <span class="n">withSQL</span> <span class="o">{</span>
  <span class="n">select</span>
    <span class="o">.</span><span class="na">from</span><span class="o">[</span><span class="n">Order</span><span class="o">](</span><span class="n">Order</span> <span class="n">as</span> <span class="n">o</span><span class="o">)</span>
    <span class="o">.</span><span class="na">innerJoin</span><span class="o">(</span><span class="n">Product</span> <span class="n">as</span> <span class="n">p</span><span class="o">).</span><span class="na">on</span><span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">productId</span><span class="o">,</span> <span class="n">p</span><span class="o">.</span><span class="na">id</span><span class="o">)</span>
    <span class="o">.</span><span class="na">map</span> <span class="o">{</span> <span class="n">sql</span> <span class="o">=&gt;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">accountRequired</span><span class="o">)</span> <span class="n">sql</span><span class="o">.</span><span class="na">leftJoin</span><span class="o">(</span><span class="n">Account</span> <span class="n">as</span> <span class="n">a</span><span class="o">).</span><span class="na">on</span><span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">accountId</span><span class="o">,</span> <span class="n">a</span><span class="o">.</span><span class="na">id</span><span class="o">)</span> <span class="k">else</span> <span class="n">sql</span>
    <span class="o">}.</span><span class="na">where</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">id</span><span class="o">,</span> <span class="mi">13</span><span class="o">)</span>
  <span class="o">}.</span><span class="na">map</span> <span class="o">{</span> <span class="n">rs</span> <span class="o">=&gt;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">accountRequired</span><span class="o">)</span> <span class="n">Order</span><span class="o">(</span><span class="n">o</span><span class="o">,</span> <span class="n">p</span><span class="o">,</span> <span class="n">a</span><span class="o">)(</span><span class="n">rs</span><span class="o">)</span> <span class="k">else</span> <span class="n">Order</span><span class="o">(</span><span class="n">o</span><span class="o">,</span> <span class="n">p</span><span class="o">)(</span><span class="n">rs</span><span class="o">)</span>
  <span class="o">}.</span><span class="na">single</span><span class="o">.</span><span class="na">apply</span><span class="o">()</span>
</pre>
<p>If you just need to append optional conditions, <code>toAndConditionOpt</code>, and <code>toOrConditionOpt</code> are useful.</p>
<pre class="highlight java"><span class="n">val</span> <span class="o">(</span><span class="n">productId</span><span class="o">,</span> <span class="n">accountId</span><span class="o">)</span> <span class="o">=</span> <span class="o">(</span><span class="n">Some</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="n">None</span><span class="o">)</span>
<span class="n">val</span> <span class="n">ids</span> <span class="o">=</span> <span class="n">withSQL</span> <span class="o">{</span>
  <span class="n">select</span><span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">result</span><span class="o">.</span><span class="na">id</span><span class="o">).</span><span class="na">from</span><span class="o">(</span><span class="n">Order</span> <span class="n">as</span> <span class="n">o</span><span class="o">)</span>
    <span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">sqls</span><span class="o">.</span><span class="na">toAndConditionOpt</span><span class="o">(</span>
      <span class="n">productId</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">id</span> <span class="o">=&gt;</span> <span class="n">sqls</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">productId</span><span class="o">,</span> <span class="n">id</span><span class="o">)),</span>
      <span class="n">accountId</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">id</span> <span class="o">=&gt;</span> <span class="n">sqls</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">accountId</span><span class="o">,</span> <span class="n">id</span><span class="o">))</span>
    <span class="o">))</span>
    <span class="o">.</span><span class="na">orderBy</span><span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">id</span><span class="o">)</span>
<span class="o">}.</span><span class="na">map</span><span class="o">(</span><span class="n">_</span><span class="o">.</span><span class="na">int</span><span class="o">(</span><span class="mi">1</span><span class="o">)).</span><span class="na">list</span><span class="o">.</span><span class="na">apply</span><span class="o">()</span>
</pre>
<hr/>

<h4 id="toc_5">in clause</h4>
<pre class="highlight java"><span class="n">val</span> <span class="n">inClauseResults</span> <span class="o">=</span> <span class="n">withSQL</span> <span class="o">{</span>
  <span class="n">select</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">Order</span> <span class="n">as</span> <span class="n">o</span><span class="o">)</span>
    <span class="o">.</span><span class="na">where</span><span class="o">.</span><span class="na">in</span><span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">id</span><span class="o">,</span> <span class="n">Seq</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">))</span>
<span class="o">}.</span><span class="na">map</span><span class="o">(</span><span class="n">Order</span><span class="o">(</span><span class="n">o</span><span class="o">)).</span><span class="na">list</span><span class="o">.</span><span class="na">apply</span><span class="o">()</span>
</pre>
<hr/>

<h4 id="toc_6">exists/notExists clause</h4>
<pre class="highlight java"><span class="n">withSQL</span> <span class="o">{</span>
  <span class="n">select</span><span class="o">(</span><span class="n">a</span><span class="o">.</span><span class="na">id</span><span class="o">).</span><span class="na">from</span><span class="o">(</span><span class="n">Account</span> <span class="n">as</span> <span class="n">a</span><span class="o">)</span>
    <span class="o">.</span><span class="na">where</span><span class="o">.</span><span class="na">exists</span><span class="o">(</span><span class="n">select</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">Order</span> <span class="n">as</span> <span class="n">o</span><span class="o">).</span><span class="na">where</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">accountId</span><span class="o">,</span> <span class="n">a</span><span class="o">.</span><span class="na">id</span><span class="o">))</span>
<span class="o">}.</span><span class="na">map</span><span class="o">(</span><span class="n">_</span><span class="o">.</span><span class="na">int</span><span class="o">(</span><span class="mi">1</span><span class="o">)).</span><span class="na">list</span><span class="o">.</span><span class="na">apply</span><span class="o">()</span>
</pre>
<p>It&rsquo;s also possible to pass <code>sqls</code> values.</p>
<pre class="highlight java"><span class="n">withSQL</span> <span class="o">{</span>
  <span class="n">select</span><span class="o">(</span><span class="n">a</span><span class="o">.</span><span class="na">id</span><span class="o">).</span><span class="na">from</span><span class="o">(</span><span class="n">Account</span> <span class="n">as</span> <span class="n">a</span><span class="o">)</span>
    <span class="o">.</span><span class="na">where</span><span class="o">.</span><span class="na">notExists</span><span class="o">(</span><span class="n">sqls</span><span class="s">&quot;select ${o.id} from ${Order as o} where ${o.accountId} = ${a.id}&quot;</span><span class="o">)</span>
<span class="o">}.</span><span class="na">map</span><span class="o">(</span><span class="n">_</span><span class="o">.</span><span class="na">int</span><span class="o">(</span><span class="mi">1</span><span class="o">)).</span><span class="na">list</span><span class="o">.</span><span class="na">apply</span><span class="o">()</span>
</pre>
<hr/>

<h4 id="toc_7">between</h4>
<pre class="highlight java"><span class="n">withSQL</span> <span class="o">{</span>
  <span class="n">select</span><span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">result</span><span class="o">.</span><span class="na">id</span><span class="o">).</span><span class="na">from</span><span class="o">(</span><span class="n">Order</span> <span class="n">as</span> <span class="n">o</span><span class="o">).</span><span class="na">where</span><span class="o">.</span><span class="na">between</span><span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">id</span><span class="o">,</span> <span class="mi">13</span><span class="o">,</span> <span class="mi">22</span><span class="o">)</span>
<span class="o">}.</span><span class="na">map</span><span class="o">(</span><span class="n">_</span><span class="o">.</span><span class="na">int</span><span class="o">(</span><span class="mi">1</span><span class="o">)).</span><span class="na">list</span><span class="o">.</span><span class="na">apply</span><span class="o">()</span>
</pre>
<hr/>

<h4 id="toc_8">distinct count</h4>
<pre class="highlight java"><span class="kn">import</span> <span class="nn">sqls.</span><span class="o">{</span> <span class="n">distinct</span><span class="o">,</span> <span class="n">count</span> <span class="o">}</span>
<span class="n">val</span> <span class="n">productCount</span> <span class="o">=</span> <span class="n">withSQL</span> <span class="o">{</span>
  <span class="n">select</span><span class="o">(</span><span class="n">count</span><span class="o">(</span><span class="n">distinct</span><span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">productId</span><span class="o">))).</span><span class="na">from</span><span class="o">(</span><span class="n">Order</span> <span class="n">as</span> <span class="n">o</span><span class="o">)</span>
<span class="o">}.</span><span class="na">map</span><span class="o">(</span><span class="n">_</span><span class="o">.</span><span class="na">int</span><span class="o">(</span><span class="mi">1</span><span class="o">)).</span><span class="na">single</span><span class="o">.</span><span class="na">apply</span><span class="o">().</span><span class="na">get</span>
</pre>
<hr/>

<h4 id="toc_9">group by queries</h4>
<pre class="highlight java"><span class="kn">import</span> <span class="nn">sqls.count</span>
<span class="n">withSQL</span> <span class="o">{</span>
  <span class="n">select</span><span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">accountId</span><span class="o">,</span> <span class="n">count</span><span class="o">).</span><span class="na">from</span><span class="o">(</span><span class="n">Order</span> <span class="n">as</span> <span class="n">o</span><span class="o">)</span>
    <span class="o">.</span><span class="na">where</span><span class="o">.</span><span class="na">isNotNull</span><span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">accountId</span><span class="o">)</span>
    <span class="o">.</span><span class="na">groupBy</span><span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">accountId</span><span class="o">)</span>
<span class="o">}.</span><span class="na">map</span><span class="o">(</span><span class="n">rs</span> <span class="o">=&gt;</span> <span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">int</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="n">rs</span><span class="o">.</span><span class="na">int</span><span class="o">(</span><span class="mi">2</span><span class="o">))).</span><span class="na">list</span><span class="o">.</span><span class="na">apply</span><span class="o">()</span>
</pre>
<hr/>

<h4 id="toc_10">union, unionAll queries</h4>
<pre class="highlight java"><span class="n">withSQL</span> <span class="o">{</span>
  <span class="n">select</span><span class="o">(</span><span class="n">a</span><span class="o">.</span><span class="na">id</span><span class="o">).</span><span class="na">from</span><span class="o">(</span><span class="n">Account</span> <span class="n">as</span> <span class="n">a</span><span class="o">)</span>
    <span class="o">.</span><span class="na">union</span><span class="o">(</span><span class="n">select</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">id</span><span class="o">).</span><span class="na">from</span><span class="o">(</span><span class="n">Product</span> <span class="n">as</span> <span class="n">p</span><span class="o">))</span>
    <span class="c1">//.unionAll(select(p.id).from(Product as p))</span>
<span class="o">}.</span><span class="na">map</span><span class="o">(</span><span class="n">_</span><span class="o">.</span><span class="na">int</span><span class="o">(</span><span class="mi">1</span><span class="o">)).</span><span class="na">list</span><span class="o">.</span><span class="na">apply</span><span class="o">()</span>
</pre>
<hr/>

<h4 id="toc_11">Sub-queries</h4>
<pre class="highlight java"><span class="kn">import</span> <span class="nn">SQLSyntax.</span><span class="o">{</span> <span class="n">sum</span><span class="o">,</span> <span class="n">gt</span> <span class="o">}</span>
<span class="n">val</span> <span class="n">x</span> <span class="o">=</span> <span class="n">SubQuery</span><span class="o">.</span><span class="na">syntax</span><span class="o">(</span><span class="s">&quot;x&quot;</span><span class="o">).</span><span class="na">include</span><span class="o">(</span><span class="n">o</span><span class="o">,</span> <span class="n">p</span><span class="o">)</span>
<span class="n">val</span> <span class="nl">preferredClients:</span> <span class="n">List</span><span class="o">[(</span><span class="n">Int</span><span class="o">,</span> <span class="n">Int</span><span class="o">)]</span> <span class="o">=</span> <span class="n">withSQL</span> <span class="o">{</span>
  <span class="n">select</span><span class="o">(</span><span class="n">sqls</span><span class="s">&quot;${x(o).accountId} id&quot;</span><span class="o">,</span> <span class="n">sqls</span><span class="s">&quot;${sum(x(p).price)} as amount&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">from</span> <span class="o">{</span> <span class="n">select</span><span class="o">.</span><span class="na">all</span><span class="o">(</span><span class="n">o</span><span class="o">,</span> <span class="n">p</span><span class="o">).</span><span class="na">from</span><span class="o">(</span><span class="n">Order</span> <span class="n">as</span> <span class="n">o</span><span class="o">).</span><span class="na">innerJoin</span><span class="o">(</span><span class="n">Product</span> <span class="n">as</span> <span class="n">p</span><span class="o">).</span><span class="na">on</span><span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">productId</span><span class="o">,</span> <span class="n">p</span><span class="o">.</span><span class="na">id</span><span class="o">).</span><span class="na">as</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">}</span>
    <span class="o">.</span><span class="na">groupBy</span><span class="o">(</span><span class="n">x</span><span class="o">(</span><span class="n">o</span><span class="o">).</span><span class="na">accountId</span><span class="o">)</span>
    <span class="o">.</span><span class="na">having</span><span class="o">(</span><span class="n">gt</span><span class="o">(</span><span class="n">sum</span><span class="o">(</span><span class="n">x</span><span class="o">(</span><span class="n">p</span><span class="o">).</span><span class="na">price</span><span class="o">),</span> <span class="mi">300</span><span class="o">))</span>
    <span class="o">.</span><span class="na">orderBy</span><span class="o">(</span><span class="n">sqls</span><span class="s">&quot;amount&quot;</span><span class="o">)</span>
  <span class="o">}.</span><span class="na">map</span><span class="o">(</span><span class="n">rs</span> <span class="o">=&gt;</span> <span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">int</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">),</span> <span class="n">rs</span><span class="o">.</span><span class="na">int</span><span class="o">(</span><span class="s">&quot;amount&quot;</span><span class="o">))).</span><span class="na">list</span><span class="o">.</span><span class="na">apply</span><span class="o">()</span>
</pre>
<hr/>

<h4 id="toc_12">Insert</h4>
<pre class="highlight java"><span class="n">withSQL</span> <span class="o">{</span>
  <span class="n">insert</span><span class="o">.</span><span class="na">into</span><span class="o">(</span><span class="n">Member</span><span class="o">).</span><span class="na">values</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="s">&quot;Alice&quot;</span><span class="o">,</span> <span class="n">DateTime</span><span class="o">.</span><span class="na">now</span><span class="o">)</span>
<span class="o">}.</span><span class="na">update</span><span class="o">.</span><span class="na">apply</span><span class="o">()</span>

<span class="n">withSQL</span> <span class="o">{</span>
  <span class="n">val</span> <span class="n">m</span> <span class="o">=</span> <span class="n">Member</span><span class="o">.</span><span class="na">column</span>
  <span class="n">insert</span><span class="o">.</span><span class="na">into</span><span class="o">(</span><span class="n">Member</span><span class="o">).</span><span class="na">namedValues</span><span class="o">(</span>
    <span class="n">m</span><span class="o">.</span><span class="na">id</span> <span class="o">-&gt;</span> <span class="mi">1</span><span class="o">,</span> 
    <span class="n">m</span><span class="o">.</span><span class="na">name</span> <span class="o">-&gt;</span> <span class="s">&quot;Alice&quot;</span><span class="o">,</span> 
    <span class="n">m</span><span class="o">.</span><span class="na">createdAt</span> <span class="o">-&gt;</span> <span class="n">DateTime</span><span class="o">.</span><span class="na">now</span>
  <span class="o">)</span>
<span class="o">}.</span><span class="na">update</span><span class="o">.</span><span class="na">apply</span><span class="o">()</span>
</pre>
<p>Or <code>applyUpdate</code> is much simpler. But in some cases, applyUpdate causes compilation errors since Scala 2.10.1. This is not an issue of ScalikeJDBC. If you suffered it, use <code>withSQL { }.update.apply()</code> instead.</p>
<pre class="highlight java"><span class="n">applyUpdate</span> <span class="o">{</span> <span class="n">insert</span><span class="o">.</span><span class="na">into</span><span class="o">(</span><span class="n">Member</span><span class="o">).</span><span class="na">values</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="s">&quot;Bob&quot;</span><span class="o">,</span> <span class="n">DateTime</span><span class="o">.</span><span class="na">now</span><span class="o">)</span> <span class="o">}</span>

<span class="n">val</span> <span class="n">c</span> <span class="o">=</span> <span class="n">Member</span><span class="o">.</span><span class="na">column</span>
<span class="n">applyUpdate</span> <span class="o">{</span>
  <span class="n">insert</span><span class="o">.</span><span class="na">into</span><span class="o">(</span><span class="n">Member</span><span class="o">).</span><span class="na">columns</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">id</span><span class="o">,</span> <span class="n">c</span><span class="o">.</span><span class="na">name</span><span class="o">,</span> <span class="n">c</span><span class="o">.</span><span class="na">createdAt</span><span class="o">).</span><span class="na">values</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="s">&quot;Bob&quot;</span><span class="o">,</span> <span class="n">DateTime</span><span class="o">.</span><span class="na">now</span><span class="o">)</span>
<span class="o">}</span>
</pre>
<hr/>

<h4 id="toc_13">Insert select</h4>
<pre class="highlight java"><span class="k">case</span> <span class="kd">class</span> <span class="nf">Product</span><span class="p">(</span><span class="nl">id:</span> <span class="n">Int</span><span class="o">,</span> <span class="nl">name:</span> <span class="n">Option</span><span class="o">[</span><span class="n">String</span><span class="o">],</span> <span class="nl">price:</span> <span class="n">Int</span><span class="o">)</span>
<span class="n">object</span> <span class="n">Product</span> <span class="kd">extends</span> <span class="n">SQLSyntaxSupport</span><span class="o">[</span><span class="n">Product</span><span class="o">]</span>
<span class="k">case</span> <span class="kd">class</span> <span class="nf">LegacyProduct</span><span class="p">(</span><span class="nl">id:</span> <span class="n">Option</span><span class="o">[</span><span class="n">Int</span><span class="o">],</span> <span class="nl">name:</span> <span class="n">Option</span><span class="o">[</span><span class="n">String</span><span class="o">],</span> <span class="nl">price:</span> <span class="n">Int</span><span class="o">)</span>
<span class="n">object</span> <span class="n">LegacyProduct</span> <span class="kd">extends</span> <span class="n">SQLSyntaxSupport</span><span class="o">[</span><span class="n">LegacyProduct</span><span class="o">]</span>

<span class="n">val</span> <span class="n">lp</span> <span class="o">=</span> <span class="n">LegacyProduct</span><span class="o">.</span><span class="na">syntax</span><span class="o">(</span><span class="s">&quot;lp&quot;</span><span class="o">)</span>
<span class="n">withSQL</span> <span class="o">{</span>
  <span class="n">insert</span><span class="o">.</span><span class="na">into</span><span class="o">(</span><span class="n">Product</span><span class="o">).</span><span class="na">select</span><span class="o">(</span><span class="n">_</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">LegacyProduct</span> <span class="n">as</span> <span class="n">lp</span><span class="o">).</span><span class="na">where</span><span class="o">.</span><span class="na">isNotNull</span><span class="o">(</span><span class="n">lp</span><span class="o">.</span><span class="na">id</span><span class="o">))</span>
<span class="o">}.</span><span class="na">update</span><span class="o">.</span><span class="na">apply</span><span class="o">()</span>
</pre>
<hr/>

<h4 id="toc_14">Delete</h4>
<pre class="highlight java"><span class="n">withSQL</span> <span class="o">{</span>
  <span class="n">delete</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">Member</span><span class="o">).</span><span class="na">where</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">Member</span><span class="o">.</span><span class="na">column</span><span class="o">.</span><span class="na">id</span><span class="o">,</span> <span class="mi">123</span><span class="o">)</span>
<span class="o">}.</span><span class="na">update</span><span class="o">.</span><span class="na">apply</span><span class="o">()</span>
</pre>
<hr/>

<h4 id="toc_15">Update</h4>
<pre class="highlight java"><span class="n">withSQL</span> <span class="o">{</span>
  <span class="n">update</span><span class="o">(</span><span class="n">Member</span><span class="o">).</span><span class="na">set</span><span class="o">(</span>
    <span class="n">Member</span><span class="o">.</span><span class="na">column</span><span class="o">.</span><span class="na">name</span> <span class="o">-&gt;</span> <span class="s">&quot;Chris&quot;</span><span class="o">,</span>
    <span class="n">Member</span><span class="o">.</span><span class="na">column</span><span class="o">.</span><span class="na">updatedAt</span> <span class="o">-&gt;</span> <span class="n">DateTime</span><span class="o">.</span><span class="na">now</span>
  <span class="o">).</span><span class="na">where</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">Member</span><span class="o">.</span><span class="na">column</span><span class="o">.</span><span class="na">id</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span>
<span class="o">}.</span><span class="na">update</span><span class="o">.</span><span class="na">apply</span><span class="o">()</span>
</pre>
<hr/>

<h4 id="toc_16">Avoiding Method Name Conflict</h4>

<p>For example, if your code already uses <code>select</code>, <code>insert</code> or <code>update</code> as method name, name confliction occurs.</p>
<pre class="highlight java"><span class="n">def</span> <span class="nf">insert</span><span class="p">(</span><span class="nl">e:</span> <span class="n">Member</span><span class="o">)(</span><span class="n">implicit</span> <span class="nl">session:</span> <span class="n">DBSession</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">withSQL</span> <span class="o">{</span>
    <span class="n">insert</span> <span class="c1">// compilation error</span>
      <span class="o">.</span><span class="na">into</span><span class="o">(</span><span class="n">Member</span><span class="o">).</span><span class="na">values</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">id</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">name</span><span class="o">)</span>
  <span class="o">}.</span><span class="na">update</span><span class="o">.</span><span class="na">apply</span><span class="o">()</span>
<span class="o">}</span>
</pre>
<p>Use <code>QueryDSL</code> prefix or <code>insertInto</code>, <code>deleteFrom</code>.</p>
<pre class="highlight java"><span class="n">def</span> <span class="nf">insert</span><span class="p">(</span><span class="nl">e:</span> <span class="n">Member</span><span class="o">)(</span><span class="n">implicit</span> <span class="nl">session:</span> <span class="n">DBSession</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">withSQL</span> <span class="o">{</span>
    <span class="n">QueryDSL</span><span class="o">.</span><span class="na">insert</span><span class="o">.</span><span class="na">into</span><span class="o">(</span><span class="n">Member</span><span class="o">).</span><span class="na">values</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">id</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">name</span><span class="o">)</span>
  <span class="o">}.</span><span class="na">update</span><span class="o">.</span><span class="na">apply</span><span class="o">()</span>
<span class="o">}</span>

<span class="n">def</span> <span class="nf">insert</span><span class="p">(</span><span class="nl">e:</span> <span class="n">Member</span><span class="o">)(</span><span class="n">implicit</span> <span class="nl">session:</span> <span class="n">DBSession</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">withSQL</span> <span class="o">{</span>
    <span class="n">insertInto</span><span class="o">(</span><span class="n">Member</span><span class="o">).</span><span class="na">values</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">id</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">name</span><span class="o">)</span>
  <span class="o">}.</span><span class="na">update</span><span class="o">.</span><span class="na">apply</span><span class="o">()</span>
<span class="o">}</span>

<span class="n">def</span> <span class="nf">delete</span><span class="p">(</span><span class="nl">id:</span> <span class="n">Long</span><span class="o">)(</span><span class="n">implicit</span> <span class="nl">session:</span> <span class="n">DBSession</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">withSQL</span> <span class="o">{</span>
    <span class="n">deleteFrom</span><span class="o">(</span><span class="n">Member</span><span class="o">).</span><span class="na">where</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">Member</span><span class="o">.</span><span class="na">column</span><span class="o">.</span><span class="na">id</span><span class="o">,</span> <span class="n">id</span><span class="o">)</span>
  <span class="o">}.</span><span class="na">update</span><span class="o">.</span><span class="na">apply</span><span class="o">()</span>
<span class="o">}</span>
</pre>
            <hr/>
            <div class="alert alert-info small"> 
              If this webpage has typo or something wrong, Please report or fix. <a href="/contribution.html">How?</a>
            </div> 
<a href="https://twitter.com/ScalikeJDBC" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @ScalikeJDBC</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
          </div>
        </div>
      </div>
    </div>
    <script type="text/javascript" src="//netdna.bootstrapcdn.com/bootstrap/3.0.1/js/bootstrap.min.js"></script>
  </body>
</html>

